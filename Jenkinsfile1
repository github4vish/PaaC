
// Powered by Infostretch 

timestamps {

node ('maven-slave') { 

	stage ('01 - Validate and Compile - Checkout') {
 	 checkout([$class: 'GitSCM', branches: [[name: '*/master']], doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [], userRemoteConfigs: [[credentialsId: '', url: 'https://github.com/github4vish/spring-hibernate-maven-webapp.git']]]) 
	}
	stage ('01 - Validate and Compile - Build') {
 			// Maven build step
	withMaven { 
 			if(isUnix()) {
 				sh "mvn validate compile " 
			} else { 
 				bat "mvn validate compile " 
			} 
 		} 
	}
	stage ('02 - Unit Testing - Build') {
 			// Maven build step
	withMaven { 
 			if(isUnix()) {
 				sh "mvn test " 
			} else { 
 				bat "mvn test " 
			} 
 		}
		// JUnit Results
		junit '**/target/surefire-reports/*.xml' 
	}
}
node () { 

	stage ('03 - Cobertura Code Coverage - Build') {
 			// Maven build step
	withMaven { 
 			if(isUnix()) {
 				sh "mvn cobertura:cobertura -Dcobertura.report.format=xml " 
			} else { 
 				bat "mvn cobertura:cobertura -Dcobertura.report.format=xml " 
			} 
 		} 
	}
}
node ('maven-slave') { 

	stage ('04 - Documentation - Build') {
 			// Maven build step
	withMaven { 
 			if(isUnix()) {
 				sh "mvn javadoc:javadoc " 
			} else { 
 				bat "mvn javadoc:javadoc " 
			} 
 		} 
	}
	stage ('05 - Sonar Analysis - Code Analysis - Build') {
 
    
    withSonarQubeEnv('Sonar') {
            sh "mvn clean compile sonar:sonar "
        }
    

    
	}
}
node ('maven-slave') { 

	stage ('06 - Packaging and Nexus Release - Build') {
 			// Maven build step
	withMaven(mavenSettingsFilePath: 'settings.xml') { 
 			if(isUnix()) {
 				sh "mvn clean package deploy " 
			} else { 
 				bat "mvn clean package deploy " 
			} 
 		} 
	}
}
node ('maven-slave') { 

	stage ('07 - Tomcat Deployment - Build') {
 			// Maven build step
	withMaven { 
 			if(isUnix()) {
 				sh "mvn clean package " 
			} else { 
 				bat "mvn clean package " 
			} 
 		} 
	}
}
}
